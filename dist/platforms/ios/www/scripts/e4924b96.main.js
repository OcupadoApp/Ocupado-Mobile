window._ENV='production';(function(){window.deviceReady=$.Deferred(),window.Ocupado=_.extend({env:"undefined"!=typeof _ENV&&null!==_ENV?_ENV:"development",config:{clientId:"65475530667.apps.googleusercontent.com",apiKey:"AIzaSyD8ZlE3oF6jOelOFr56heE8FC6Sk3UkiVo",scopes:["https://www.googleapis.com/auth/calendar"]},Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";return Ocupado.calendars=new this.Collections.CalendarCollection,Ocupado.roomsView=new this.Views.RoomsView({collection:new this.Collections.RoomsCollection}),Ocupado.chromeView=new this.Views.ChromeView,window.addEventListener("load",function(){return FastClick.attach(document.body)})}},Backbone.Events),"production"===Ocupado.env?$(function(){return $.when([clientLoaded.promise(),deviceReady.promise()]).then(Ocupado.init()),document.addEventHandler("deviceready",function(){return deviceReady.resolve()})}):$(function(){return Ocupado.init()})}).call(this),function(){window.ISODateString=function(a){var b,c;return b=function(a){return 10>a?"0"+a:a},c=a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z"},window.toReadableTime=function(a){var b,c,d;return b=Math.floor(a/1e3/60/60),c=Math.floor(a/1e3/60-60*b),d=Math.floor(a/1e3-60*c-60*b*60),10>b&&(b="0"+b),10>c&&(c="0"+c),10>d&&(d="0"+d),b>=0&&c>=0&&d>=0?""+b+":"+c+":"+d:"00:00:00"},Date.prototype.addHours=function(a){return this.setHours(this.getHours()+a),this},Date.prototype.subtractHours=function(a){return this.setHours(this.getHours()-a),this},Date.prototype.addMinutes=function(a){return this.setMinutes(this.getMinutes()+a),this},Date.prototype.subtractMinutes=function(a){return this.setMinutes(this.getMinutes()-a),this},Date.prototype.addMilliseconds=function(a){return this.setMilliseconds(this.getMilliseconds()+a),this},Date.prototype.subtractMilliseconds=function(a){return this.setMilliseconds(this.getMilliseconds()-a),this},window.RaphaelArc=function(a,b,c,d,e){var f,g,h,i,j;return g=360/d*c,f=(90-g)*Math.PI/180,i=a+e*Math.cos(f),j=b-e*Math.sin(f),h=d===c?[["M",a,b-e],["A",e,e,0,1,1,a-.01,b-e]]:[["M",a,b-e],["A",e,e,0,+(g>180),1,i,j]],{path:h}}}.call(this),function(){window.clientLoaded=$.Deferred(),window.handleClientLoad=function(){return clientLoaded.resolve(),gapi.client.setApiKey(Ocupado.config.apiKey),window.setTimeout(Ocupado.Auth.checkAuth,1)},window.Ocupado.Auth={isAuthenticated:!1,checkAuth:function(){return gapi.auth.authorize({client_id:Ocupado.config.clientId,scope:Ocupado.config.scopes,immediate:!0},Ocupado.Auth.handleAuthResult)},handleAuthResult:function(a){var b;return b=$("#authorizeButton"),a&&!a.error?(b.hide(),Ocupado.trigger("ocupado:auth:success"),Ocupado.Auth.isAuthenticated=!0,gapi.client.load("calendar","v3",Ocupado.Auth.calendarAPILoaded)):(b.show(),b.on("click",function(){return Ocupado.Auth.handleAuthClick()}),Ocupado.trigger("ocupado:auth:failure"),Ocupado.Auth.isAuthenticated=!1)},handleAuthClick:function(){return gapi.auth.authorize({client_id:Ocupado.config.clientId,scope:Ocupado.config.scopes,immediate:!1},Ocupado.Auth.handleAuthResult),!1},calendarAPILoaded:function(){return Ocupado.trigger("ocupado:auth:calendarloaded")}}}.call(this),this.Ocupado=this.Ocupado||{},this.Ocupado.Templates=this.Ocupado.Templates||{},Handlebars.registerPartial("occupied",this.Ocupado.Templates.occupied=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="icon-clock">&#128340;</div>\n\n<div class="time-remaining">',(f=c.timeRemaining)?f=f.call(b,{hash:{},data:e}):(f=b&&b.timeRemaining,f=typeof f===h?f.call(b,{hash:{},data:e}):f),g+=i(f)+"</div>\n\n<h1>",(f=c.name)?f=f.call(b,{hash:{},data:e}):(f=b&&b.name,f=typeof f===h?f.call(b,{hash:{},data:e}):f),g+=i(f)+'</h1>\n\n<div class="room-status-text">ocupado</div>\n\n<div class="group-bottom">\n  <div class="creator-name">'+i((f=b&&b.event,f=null==f||f===!1?f:f.creatorName,typeof f===h?f.apply(b):f))+'</div>\n  <img src="'+i((f=b&&b.event,f=null==f||f===!1?f:f.creatorImage,typeof f===h?f.apply(b):f))+'" class="creator-image">\n</div>\n\n'})),Handlebars.registerPartial("upcoming",this.Ocupado.Templates.upcoming=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="icon-clock">&#128340;</div>\n\n<div class="time-remaining">',(f=c.timeRemaining)?f=f.call(b,{hash:{},data:e}):(f=b&&b.timeRemaining,f=typeof f===h?f.call(b,{hash:{},data:e}):f),g+=i(f)+"</div>\n\n<h1>",(f=c.name)?f=f.call(b,{hash:{},data:e}):(f=b&&b.name,f=typeof f===h?f.call(b,{hash:{},data:e}):f),g+=i(f)+'</h1>\n\n<div class="room-status-text">próximo</div>\n\n<div class="group-bottom">\n  <div class="up-next">\n    <span class="up-next-text">Up Next</span>\n    <span class="icon-arrow-right">&#59238;</span>\n    <span class="icon-person">&#128100;</span>\n    <span class="name">'+i((f=b&&b.event,f=null==f||f===!1?f:f.creatorName,typeof f===h?f.apply(b):f))+"</name>\n  </div>\n</div>\n\n"})),Handlebars.registerPartial("vacant",this.Ocupado.Templates.vacant=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="icon-clock">&#128340;</div>\n<div class="time-remaining">',(f=c.timeRemaining)?f=f.call(b,{hash:{},data:e}):(f=b&&b.timeRemaining,f=typeof f===h?f.call(b,{hash:{},data:e}):f),g+=i(f)+"</div>\n<h1>",(f=c.name)?f=f.call(b,{hash:{},data:e}):(f=b&&b.name,f=typeof f===h?f.call(b,{hash:{},data:e}):f),g+=i(f)+'</h1>\n<div class="room-status-text">vacantó</div>\n\n<div class="group-bottom">\n  <div class="book-room">Book this room</div>\n  <div class="book-room-icon">+</div>\n</div>\n\n'})),this.Ocupado.Templates["app/scripts/templates/calendarSelectionModal.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e,f="";return f+="\n    <label",d=c.unless.call(a,a&&a.isSelected,{hash:{},inverse:k.noop,fn:k.program(2,g,b),data:b}),(d||0===d)&&(f+=d),f+='>\n      <div class="draggable-handle" style="border-bottom: 5px solid '+m((d=a&&a.color,typeof d===l?d.apply(a):d))+';">..<br>..</div>\n      '+m((d=a&&a.name,typeof d===l?d.apply(a):d))+'\n      <input type="checkbox" ',e=c["if"].call(a,a&&a.isSelected,{hash:{},inverse:k.noop,fn:k.program(4,h,b),data:b}),(e||0===e)&&(f+=e),f+=' data-resourceid="'+m((d=a&&a.resourceId,typeof d===l?d.apply(a):d))+'" />\n    </label>\n    '}function g(){return' class="inactive"'}function h(){return"checked"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j="",k=this,l="function",m=this.escapeExpression;return j+='<div class="modal-overlay"></div>\n\n<div class="modal">\n  <h2>Rooms to display:</h2>\n  <a class="close-modal">&#10006;</a>\n  <hr />\n  <div class="checkbox-group">\n    ',i=c.each.call(b,b&&b.cals,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+="\n  </div>\n</div>\n"}),this.Ocupado.Templates["app/scripts/templates/chrome.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<a href="#" id="calendarMenuBtn">...</a>\n\n'}),this.Ocupado.Templates["app/scripts/templates/newEventDialog.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div class="modal-overlay"></div>\n\n<div class="time-duration-container">\n  <div class="duration-top">60</div>\n  <div class="duration-right">15</div>\n  <div class="duration-bottom">30</div>\n  <div class="duration-left">45</div>\n</div>\n\n<button class="cancel-event">Cancel</button>\n\n'}),this.Ocupado.Templates["app/scripts/templates/room.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var e,f="";return f+="\n  ",e=k.invokePartial(d.occupied,"occupied",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function g(a,b){var e,f="";return f+="\n  ",e=k.invokePartial(d.upcoming,"upcoming",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function h(a,b){var e,f="";return f+="\n  ",e=k.invokePartial(d.vacant,"vacant",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),d=this.merge(d,a.partials),e=e||{};var i,j="",k=this;return i=c["if"].call(b,b&&b.occupied,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+="\n",i=c["if"].call(b,b&&b.upcoming,{hash:{},inverse:k.noop,fn:k.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+="\n",i=c["if"].call(b,b&&b.vacant,{hash:{},inverse:k.noop,fn:k.program(5,h,e),data:e}),(i||0===i)&&(j+=i),j+="\n"}),this.Ocupado.Templates["app/scripts/templates/roomsNav.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a){var b,c="";return c+='\n  <li data-calendarid="'+j((b=a&&a.calendarId,typeof b===i?b.apply(a):b))+'">'+j((b=a&&a.name,typeof b===i?b.apply(a):b))+"</li>\n"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h="",i="function",j=this.escapeExpression,k=this;return g=c.each.call(b,b&&b.rooms,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(g||0===g)&&(h+=g),h+="\n\n"}),function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Ocupado.Models.EventModel=function(c){function e(){return this.onEventInsertion=b(this.onEventInsertion,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.timeRemaining=!1,e.prototype.intervalRef=!1,e.prototype.initialize=function(){return null!=this.get("isNew")?this.assembleResource():(this.on("event:start",this.eventStart,this),this.on("event:end",this.eventEnd,this),this.set("creatorImage",this.creatorImagePath()),this.isOccurring()?this.trigger("event:start"):this.isUpcoming()?this.eventUpcoming():void 0)},e.prototype.eventStart=function(){var a,b=this;return a=this.get("endDate")-Date.now(),setTimeout(function(){return b.trigger("event:end")},a),this.intervalRef&&clearInterval(this.intervalRef),this.intervalRef=setInterval(function(){return b.timeRemaining=b.get("endDate")-Date.now()},50),this.get("room").trigger("update")},e.prototype.eventUpcoming=function(){var a=this;return setTimeout(function(){return a.trigger("event:start")},this.get("startDate")-Date.now()),this.intervalRef=setInterval(function(){return a.timeRemaining=a.get("startDate")-Date.now()},50)},e.prototype.eventEnd=function(){var a;return clearInterval(this.intervalRef),a=this.get("room"),this.collection.remove(this),a.trigger("update")},e.prototype.creatorImagePath=function(){return"http://www.gravatar.com/avatar/"+md5(this.get("creatorEmail"))+"?s=220"},e.prototype.isOccurring=function(){var a;return this.get("startDate")<=(a=Date.now())&&a<=this.get("endDate")},e.prototype.isUpcoming=function(){var a;return a=(new Date).addHours(1).getTime(),this.get("startDate")<=a&&this.get("startDate")>Date.now()},e.prototype.assembleResource=function(){var a;return a={summary:"Room booked by Ocupado: "+this.get("room").get("name"),location:"Room: "+this.get("room").get("name"),start:{dateTime:(new Date).toISOString()},end:{dateTime:(new Date).addMinutes(this.get("duration")).toISOString()},attendees:[{email:this.get("room").get("calendarId")}]},this.insertEvent(a)},e.prototype.insertEvent=function(a){var b;return b=gapi.client.calendar.events.insert({calendarId:"primary",resource:a}),b.execute(this.onEventInsertion),this.get("dialogView").loading(!0)},e.prototype.onEventInsertion=function(){var a=this;return this.get("room").fetch(),this.get("room").once("update",function(){return setTimeout(function(){return a.get("dialogView").loading(!1)},100)})},e}(Backbone.RelationalModel)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Ocupado.Collections.EventsCollection=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.model=Ocupado.Models.EventModel,d.prototype.comparator="startDate",d.prototype.isOccupied=function(){return!!this.whereOccupied().length},d.prototype.isUpcoming=function(){return!!this.whereUpcoming().length},d.prototype.isVacant=function(){return!this.isOccupied()&&!this.isUpcoming()},d.prototype.whereOccupied=function(){return this.filter(function(a){return a.isOccurring()})},d.prototype.whereUpcoming=function(){return this.filter(function(a){return a.isUpcoming()})},d}(Backbone.Collection)}.call(this),function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Ocupado.Models.RoomModel=function(c){function e(){return this.fetchResponse=b(this.fetchResponse,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.defaults={state:"vacant",current:!1,upcoming:!1,calendarId:!1,name:!1},e.prototype.relations=[{type:Backbone.HasMany,key:"events",relatedModel:"Ocupado.Models.EventModel",collectionType:"Ocupado.Collections.EventsCollection",includeInJSON:!0,reverseRelation:{key:"room"}}],e.prototype.initialize=function(){var a=this;return this.get("unAuthenticated")||this.fetch(),this.collection.on("fetchAll",this.fetch,this),setInterval(function(){return a.fetch.call(a)},6e5),this},e.prototype.fetch=function(){var a,b,c;return a=(new Date).addHours(3),b=new Date,c=gapi.client.calendar.events.list({calendarId:this.get("calendarId"),timeMax:ISODateString(a),timeMin:ISODateString(b),orderBy:"startTime",singleEvents:!0,timeZone:"America/Toronto"}),c.execute(this.fetchResponse)},e.prototype.fetchResponse=function(a){var b,c=this;return this.get("events").each(function(a){return c.get("events").remove(a)}),this.get("name").length||this.set("name",a.summary),(null!=(b=a.items)?b.length:void 0)>0&&(this.createEventModelFromEvent(a.items[0]),a.items.length>1&&this.createEventModelFromEvent(a.items[1])),this.trigger("update")},e.prototype.createEventModelFromEvent=function(a){return new Ocupado.Models.EventModel({startDate:Date.parse(a.start.dateTime),endDate:Date.parse(a.end.dateTime),creatorName:a.creator.displayName,creatorEmail:a.creator.email,name:a.summary,room:this})},e.prototype.isOccupied=function(){return this.hasEvents()?this.get("events").isOccupied():!1},e.prototype.isUpcoming=function(){return this.hasEvents()?this.get("events").isUpcoming()&&!this.isOccupied():!1},e.prototype.isVacant=function(){return this.hasEvents()?this.get("events").isVacant()&&!this.isOccupied()&&!this.isUpcoming():!0},e.prototype.hasEvents=function(){return!!this.get("events").length},e.prototype.percentComplete=function(){var a;return this.isOccupied()?(a=this.get("events").sort().first(),(Date.now()-a.get("startDate"))/(a.get("endDate")-a.get("startDate"))*100):100},e}(Backbone.RelationalModel)}.call(this),function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Ocupado.Views.RoomView=function(c){function e(){return this.openNewEvent=b(this.openNewEvent,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.template=Ocupado.Templates["app/scripts/templates/room.hbs"],e.prototype.tagName="section",e.prototype.initialize=function(){var a=this;return this.listenTo(this.model,"update",this.render),this.render(),this.$el.on("click",".book-room-icon",this.openNewEvent),setInterval(function(){return a.partialRender()},1e3)},e.prototype.partialRender=function(){return this.$el.find(".time-remaining").text(this.timeRemaining())},e.prototype.render=function(){return this.$el.html(this.template(this.templateData())),this.$el.css({"min-width":$(window).width()-40+"px"}),this.$el.prop("class",""),this.model.isOccupied()?this.$el.addClass("occupied"):this.model.isUpcoming()?this.$el.addClass("upcoming"):this.$el.addClass("vacant"),null!=Ocupado.scroller&&setTimeout(function(){return Ocupado.scroller.refresh()},0),this},e.prototype.templateData=function(){var a=this;return{occupied:this.model.isOccupied(),upcoming:this.model.isUpcoming(),vacant:this.model.isVacant(),timeRemaining:function(){return a.timeRemaining()}(),name:this.model.get("name"),event:this.model.isVacant()?void 0:this.model.get("events").sort().first().toJSON()}},e.prototype.timeRemaining=function(){var a;return this.model.isVacant()?"00:00:00":(a=this.model.get("events").sort().first().timeRemaining,toReadableTime(a))},e.prototype.attributes=function(){return{"data-calendarid":this.model.get("calendarId")}},e.prototype.openNewEvent=function(){var a,b=this;return this.$el.off("click",".book-room-icon",this.openNewEvent),_.defer(function(){return b.$el.on("click",".book-room-icon",b.openNewEvent)}),$("#OcupadoChrome").append($("<div></div>")),a=new Ocupado.Views.NewEventDialogView({model:this.model,el:$("#OcupadoChrome div:last")})},e}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Ocupado.Collections.RoomsCollection=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.model=Ocupado.Models.RoomModel,d.prototype.initialize=function(){var a=this;return Ocupado.on("ocupado:auth:calendarloaded",function(){return a.get("unAuthenticated")?void 0:a.initCalendarResources()}),Ocupado.fetch=function(){return a.fetchAll()}},d.prototype.comparator=function(a){return Ocupado.calendars.getSelectedResources().indexOf(a.get("calendarId"))},d.prototype.initCalendarResources=function(){var a=this;return $.when(Ocupado.calendars.deferredFetch).then(function(){return a.setupModels()})},d.prototype.setupModels=function(){var a=this;return _.each(Ocupado.calendars.getSelectedCalendars().sort(),function(b){return a.add({calendarId:b.get("resourceId")})})},d}(Backbone.Collection)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Ocupado.Views.RoomsView=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.el="#OcupadoApp",d.prototype.template=Ocupado.Templates["app/scripts/templates/rooms.hbs"],d.prototype.initialize=function(){return this.listenTo(this.collection,"add",this.addRoom),this.listenTo(this.collection,"reset",this.resetRooms),this.listenTo(this.collection,"update",this.roomUpdate),Handlebars.registerPartial("occupied",Ocupado.Templates.occupied),Handlebars.registerPartial("upcoming",Ocupado.Templates.upcoming),Handlebars.registerPartial("vacant",Ocupado.Templates.vacant),this.navView=new Ocupado.Views.RoomsNavView({collection:this.collection})},d.prototype.addRoom=function(a){var b,c=this;return b=new Ocupado.Views.RoomView({model:a,parentView:this}),this.$el.append(b.render().el),null==Ocupado.scroller?setTimeout(function(){var a;return Ocupado.scroller=new IScroll(document.getElementById("OcupadoWrapper"),{scrollX:!0,snap:"section",momentum:!1,click:!0,probeType:3}),Ocupado.navScroller=new IScroll($("nav").get(0),{scrollX:!0,click:!0}),a=c,Ocupado.scroller.on("scroll",function(){return a.navView.scrollTo(this.x/2)}),Ocupado.scroller.on("scrollEnd",function(){return a.navView.scrollTo(this.x/2)})},0):void 0},d.prototype.resetRooms=function(){return this.$el.html(""),this.collection.each(this.addRoom,this)},d}(Backbone.View)}.call(this),function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Ocupado.Views.CalendarSelectionModalView=function(c){function e(){return this.onCheckboxChange=b(this.onCheckboxChange,this),this.close=b(this.close,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.template=Ocupado.Templates["app/scripts/templates/calendarSelectionModal.hbs"],e.prototype.initialize=function(){var a,b=this;return this.render(),this.animateModalEntering(),this.$el.find('input[type="checkbox"]').on("change",this.onCheckboxChange),a=this.updateSortOrder,new Sortable(this.$el.find(".checkbox-group").get(0),{handle:".draggable-handle",onUpdate:function(a){return b.updateSortOrder(a)}}),this.$el.on("click",".close-modal",this.close)},e.prototype.render=function(){return this.$el.html(this.template({cals:Ocupado.calendars.toJSON()})),this.overlay=this.$el.find(".modal-overlay"),this.modal=this.$el.find(".modal"),this},e.prototype.animateModalEntering=function(){var a=this;return setTimeout(function(){return a.overlay.addClass("active"),a.overlay.one("webkitTransitionEnd transitionend",function(){return a.modal.addClass("active")})},10)},e.prototype.close=function(){var a=this;return this.modal.removeClass("active"),this.modal.one("webkitTransitionEnd transitionend",function(){return a.overlay.removeClass("active"),a.overlay.one("webkitTransitionEnd transitionend",function(){return a.parentView.modal=null,a.remove(),a.unbind()})})},e.prototype.updateSortOrder=function(){var a;return a=_.map(this.$el.find('input[type="checkbox"]:checked'),function(a){return $(a).data("resourceid")}),Ocupado.calendars.setSelectedResources(a),Ocupado.roomsView.collection.reset(),Ocupado.roomsView.collection.setupModels()},e.prototype.onCheckboxChange=function(){var a;return a=[],this.$el.find('input[type="checkbox"]').each(function(){return $(this).is(":checked")?(a.push($(this).data("resourceid")),$(this).closest("label").removeClass("inactive")):$(this).closest("label").addClass("inactive")}),Ocupado.calendars.setSelectedResources(a),Ocupado.roomsView.collection.reset(),Ocupado.roomsView.collection.setupModels()},e}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Ocupado.Models.CalendarModel=function(b){function e(){return a=e.__super__.constructor.apply(this,arguments)}return c(e,b),e.prototype.initialize=function(){var a;return this.set("isSelected",(a=this.get("resourceId"),d.call(this.collection.getSelectedResources(),a)>=0))},e.prototype.isSelected=function(){var a;return a=this.get("resourceId"),d.call(this.collection.getSelectedResources(),a)>=0},e}(Backbone.Model)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Ocupado.Collections.CalendarCollection=function(b){function e(){return a=e.__super__.constructor.apply(this,arguments)}return c(e,b),e.prototype.model=Ocupado.Models.CalendarModel,e.prototype.initialize=function(){var a=this;return this.deferredFetch=$.Deferred(),Ocupado.on("ocupado:auth:calendarloaded",function(){return a.fetch(a.deferredFetch).then(function(b){return _.each(b,function(b){return a.add({color:b.backgroundColor,resourceId:b.id,name:b.summary})}),a.getSelectedResources().length?void 0:a.setSelectedResources(_.pluck(b,"id"))})})},e.prototype.comparator=function(a){return Ocupado.calendars.getSelectedResources().indexOf(a.get("resourceId"))},e.prototype.fetch=function(a){var b;return b=gapi.client.calendar.calendarList.list({}),b.execute(function(b){var c;return c=_.filter(b.items,function(a){return/@(resource|group)\.calendar\.google\.com$/.test(a.id)}),a.resolve(c)}),a.promise()},e.prototype.getSelectedResources=function(){return null!=localStorage["ocupado.selectedResources"]?JSON.parse(localStorage.getItem("ocupado.selectedResources")):[]},e.prototype.setSelectedResources=function(a){return localStorage.setItem("ocupado.selectedResources",JSON.stringify(a)),this.each(function(a){return a.set("isSelected",a.isSelected())})},e.prototype.getSelectedCalendars=function(){var a=this;return this.sort().filter(function(b){var c;return c=b.get("resourceId"),d.call(a.getSelectedResources(),c)>=0})},e}(Backbone.Collection)}.call(this),function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Ocupado.Views.ChromeView=function(c){function e(){return this.onMenuClick=b(this.onMenuClick,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.el="#OcupadoChrome",e.prototype.template=Ocupado.Templates["app/scripts/templates/chrome.hbs"],e.prototype.initialize=function(){var a=this;return this.render(),Ocupado.on("ocupado:auth:success",function(){return a.$el.show(),a.$el.on("click","#calendarMenuBtn",a.onMenuClick)})},e.prototype.render=function(){return this.$el.html(this.template())},e.prototype.onMenuClick=function(a){return a.preventDefault(),null==this.modal?(this.modal=new Ocupado.Views.CalendarSelectionModalView,this.modal.parentView=this,this.$el.append(this.modal.el)):this.modal.close()},e}(Backbone.View)}.call(this),function(){"use strict";var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Ocupado.Views.RoomsNavView=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.template=Ocupado.Templates["app/scripts/templates/roomsNav.hbs"],d.prototype.el=$("nav ul").get(0),d.prototype.initialize=function(){return this.render(),this.listenTo(this.collection,"add reset update",this.render),this.$el.find("li").on("click",this.onNavClick)},d.prototype.onNavClick=function(a){var b;return a.preventDefault(),b=$(this).data("calendarid"),Ocupado.scroller.scrollToElement($("section[data-calendarid='"+b+"']").get(0))},d.prototype.render=function(){var a=this;return this.$el.find("li").off("click",this.onNavClick),this.$el.html(this.template({rooms:this.collection.toJSON()})),_.defer(function(){var b,c,d;return b=$("#OcupadoApp section:first").width()/2,c=a.$el.find("li"),a.$el.find("li").on("click",a.onNavClick),c.css("width",b+"px"),d=b*c.length,a.$el.css("width",d+"px")}),this},d.prototype.scrollTo=function(a){return Ocupado.navScroller.scrollTo(a,0)},d}(Backbone.View)}.call(this),function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Ocupado.Views.NewEventDialogView=function(c){function e(){return this.createEvent=b(this.createEvent,this),this.close=b(this.close,this),this.closeDialog=b(this.closeDialog,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.template=Ocupado.Templates["app/scripts/templates/newEventDialog.hbs"],e.prototype.className="new-event-dialog",e.prototype.initialize=function(){return this.$el.on("click",".cancel-event",this.closeDialog),this.$el.on("click",".time-duration-container div",this.createEvent),window.foo=this,this.render()},e.prototype.render=function(){var a=this;return this.$el.html(this.template()),_.defer(function(){return a.overlay=a.$el.find(".modal-overlay"),a.container=a.$el.find(".time-duration-container"),a.cancelBtn=a.$el.find(".cancel-event"),a.overlay.addClass("active"),a.container.addClass("active"),a.cancelBtn.addClass("active")}),this},e.prototype.closeDialog=function(){return this.container.one("webkitTransitionEnd transitionEnd",this.close),this.container.removeClass("active"),this.overlay.removeClass("active"),this.cancelBtn.removeClass("active")},e.prototype.close=function(){return this.remove()},e.prototype.createEvent=function(a){var b,c;return b=parseInt($(a.target).text()),c=new Ocupado.Models.EventModel({isNew:!0,room:this.model,duration:b,dialogView:this})},e.prototype.loading=function(a){var b=this;return a?(this.container.removeClass("active"),this.cancelBtn.removeClass("active")):(this.closeDialog(),setTimeout(function(){return b.close()},400))},e}(Backbone.View)}.call(this);